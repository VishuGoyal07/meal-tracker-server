{"version":3,"file":"getShoppingListRoute.js","names":["getShoppingListRoute","method","path","handler","req","res","getIngredients","ingredients","getPopulatedMeals","meals","futureMeals","filter","meal","mealDate","Date","plannedDate","yesterday","setDate","getDate","requiredIngredients","flatMap","recipe","requiredIngredientsNames","Set","map","ingredient","name","missingIngredients","ingredientName","some","userIngredient","toLowerCase","status","json"],"sources":["../../src/routes/getShoppingListRoute.js"],"sourcesContent":["import { getIngredients } from \"../db\";\r\nimport { getPopulatedMeals } from \"../db\";\r\n\r\nexport const getShoppingListRoute={\r\n    method:'get',\r\n    path:'/shopping-list',\r\n    handler:async(req,res)=>{\r\n        const ingredients=await getIngredients();\r\n        const meals=await getPopulatedMeals();\r\n        const futureMeals=meals.filter(meal=>{\r\n            const mealDate=new Date(meal.plannedDate);\r\n            const yesterday=new Date();\r\n            yesterday.setDate(yesterday.getDate()-1);\r\n            return mealDate>yesterday;\r\n        });\r\n        const requiredIngredients=futureMeals.flatMap(meal=>meal.recipe.ingredients);\r\n        const requiredIngredientsNames=[...new Set(requiredIngredients.map(ingredient=>ingredient.name))];\r\n        const missingIngredients=requiredIngredientsNames.filter(\r\n            ingredientName=>!ingredients.some(userIngredient=>userIngredient.name===ingredientName.toLowerCase())\r\n        );\r\n        res.status(200).json(missingIngredients);\r\n    },\r\n\r\n};"],"mappings":";;;;;;;;;AAAA;;+CACA,oJ;;;;;;;;;;;;;;;;;;AAEO,IAAMA,oBAAoB,GAAC;EAC9BC,MAAM,EAAC,KADuB;EAE9BC,IAAI,EAAC,gBAFyB;EAG9BC,OAAO;IAAA,0EAAC,iBAAMC,GAAN,EAAUC,GAAV;MAAA;MAAA;QAAA;UAAA;YAAA;cAAA;cAAA,OACoB,IAAAC,kBAAA,GADpB;;YAAA;cACEC,WADF;cAAA;cAAA,OAEc,IAAAC,qBAAA,GAFd;;YAAA;cAEEC,KAFF;cAGEC,WAHF,GAGcD,KAAK,CAACE,MAAN,CAAa,UAAAC,IAAI,EAAE;gBACjC,IAAMC,QAAQ,GAAC,IAAIC,IAAJ,CAASF,IAAI,CAACG,WAAd,CAAf;gBACA,IAAMC,SAAS,GAAC,IAAIF,IAAJ,EAAhB;gBACAE,SAAS,CAACC,OAAV,CAAkBD,SAAS,CAACE,OAAV,KAAoB,CAAtC;gBACA,OAAOL,QAAQ,GAACG,SAAhB;cACH,CALiB,CAHd;cASEG,mBATF,GASsBT,WAAW,CAACU,OAAZ,CAAoB,UAAAR,IAAI;gBAAA,OAAEA,IAAI,CAACS,MAAL,CAAYd,WAAd;cAAA,CAAxB,CATtB;cAUEe,wBAVF,sBAU+B,IAAIC,GAAJ,CAAQJ,mBAAmB,CAACK,GAApB,CAAwB,UAAAC,UAAU;gBAAA,OAAEA,UAAU,CAACC,IAAb;cAAA,CAAlC,CAAR,CAV/B;cAWEC,kBAXF,GAWqBL,wBAAwB,CAACX,MAAzB,CACrB,UAAAiB,cAAc;gBAAA,OAAE,CAACrB,WAAW,CAACsB,IAAZ,CAAiB,UAAAC,cAAc;kBAAA,OAAEA,cAAc,CAACJ,IAAf,KAAsBE,cAAc,CAACG,WAAf,EAAxB;gBAAA,CAA/B,CAAH;cAAA,CADO,CAXrB;cAcJ1B,GAAG,CAAC2B,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqBN,kBAArB;;YAdI;YAAA;cAAA;UAAA;QAAA;MAAA;IAAA,CAAD;;IAAA;MAAA;IAAA;;IAAA;EAAA;AAHuB,CAA3B"}